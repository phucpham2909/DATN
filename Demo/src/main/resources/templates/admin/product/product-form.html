<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi"
      th:replace="~{/admin/layout/sidebar-layout::view(~{::title}, ~{::article})}">
<head>
    <meta charset="UTF-8">
    <title th:text="${product.id != null ? 'Cập nhật sản phẩm' : 'Thêm sản phẩm'}">Sản phẩm</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<article>
    <form th:action="@{/admin/product/save}" th:object="${product}"
          method="post" enctype="multipart/form-data"
          class="p-4 shadow rounded bg-light mt-5">

        <input type="hidden" th:field="*{id}">
        <input type="hidden" name="oldImage" th:value="${product.images}">

        <!-- Tên sản phẩm -->
        <div class="mb-3">
            <label class="form-label fw-bold">Tên sản phẩm</label>
            <input type="text" class="form-control" th:field="*{name}" placeholder="Nhập tên sản phẩm">
            <span class="text-danger" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></span>
        </div>

        <!-- Mô tả -->
        <div class="mb-3">
            <label class="form-label fw-bold">Mô tả</label>
            <textarea class="form-control" th:field="*{description}" rows="3"
                      placeholder="Nhập mô tả chi tiết"></textarea>
            <span class="text-danger" th:if="${#fields.hasErrors('description')}" th:errors="*{description}"></span>
        </div>

        <!-- Giá bán -->
        <div class="mb-3">
            <label class="form-label fw-bold">Giá bán</label>
            <div class="input-group">
                <input type="text" class="form-control" th:field="*{price}" placeholder="0"
                       oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                <span class="input-group-text">VNĐ</span>
            </div>
            <span class="text-danger" th:if="${#fields.hasErrors('price')}" th:errors="*{price}"></span>
        </div>

        <!-- Hình ảnh -->
        <div class="mb-3">
            <label class="form-label fw-bold">Hình ảnh</label>
            <input type="file" name="imageFile" class="form-control" onchange="previewImage(event)">
            <div class="mt-2">
                <img id="previewImg" th:if="${product.images != null}"
                     th:src="@{'/product-images/' + ${product.images}}" class="img-thumbnail"
                     style="max-width: 120px;">
            </div>
        </div>

        <!-- Loại sản phẩm -->
        <div class="mb-3">
            <label>Loại <span style="color: #ffcc00">*</span></label>
            <select th:field="*{categoryProduct.id}" class="form-select" required>
                <option value="" disabled th:if="${product.categoryProduct == null}" selected>-- Chọn danh mục --</option>
                <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}"
                        th:selected="${product.categoryProduct != null} ? ${cat.id} == ${product.categoryProduct.id} : false"></option>
            </select>
        </div>

        <!-- Trạng thái -->
        <div class="mb-3">
            <label class="form-label fw-bold">Trạng thái</label>
            <select class="form-select" th:field="*{active}">
                <option th:value="false">Hiển thị</option>
                <option th:value="true">Ẩn</option>
            </select>
        </div>

        <!-- Nút hành động -->
        <div class="d-flex justify-content-between mt-4">
            <a th:href="@{/admin/product/list}" class="btn btn-outline-secondary">⬅ Quay lại</a>
            <button type="submit" class="btn btn-success px-4"
                    th:text="${product.id != null ? 'Cập nhật' : 'Thêm mới'}"></button>
        </div>
    </form>
</article>

<script>
    function previewImage(event) {
        const img = document.getElementById('previewImg');
        img.src = URL.createObjectURL(event.target.files[0]);
        img.style.display = 'block';
    }
</script>
</body>
</html>
