<!DOCTYPE html>
<html lang="vi"
	th:replace="~{/shared/layout::view(~{::title}, ~{::article})}">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title th:text="${film.name}">Truy Tìm Long Diên Hương</title>

<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/font-awesome.min.css" rel="stylesheet">
<link href="css/global.css" rel="stylesheet">
<link href="css/index.css" rel="stylesheet">
<link
	href="https://fonts.googleapis.com/css2?family=Platypi:ital,wght@0,300..800;1,300..800&display=swap"
	rel="stylesheet">
<link
	href="https://fonts.googleapis.com/css2?family=Poppins&display=swap"
	rel="stylesheet">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="js/bootstrap.bundle.min.js"></script>

<style>
.star-rating {
	direction: rtl;
	display: inline-flex;
	font-size: 1.8rem;
	cursor: pointer;
}

.star-rating input {
	display: none;
}

.star-rating label {
	color: #ccc;
	transition: color 0.2s;
}

.star-rating input:checked ~ label {
	color: gold;
}

.star-rating label:hover, .star-rating label:hover ~ label {
	color: gold;
}
</style>
</head>

<body>
	<article>
 <div th:if="${popupMessage}" 
       class="alert alert-dismissible fade show mt-3"
       th:classappend="${popupType == 'error'} ? ' alert-danger' : ' alert-success'" 
       role="alert">
    <span th:text="${popupMessage}">Thông báo</span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>

		<!-- Banner -->
		<div class="container mt-4">
			<div class="row">
				<div class="col-md-4">
					<img th:if="${film.avatar != null}" th:src="@{${film.avatar}}"
						class="img-fluid rounded h-100" alt="Poster">
				</div>
				<div class="col-md-8">
					<h1 class="mb-3" th:text="${film.name}"></h1>
					<p>
						<strong th:text="#{tilte.rele}">Khởi chiếu:</strong> <span
							th:text="${formattedDate}"></span>
					</p>
					<p>
						<strong th:text="#{tilte.genre}">Thể loại:</strong> <span
							th:each="t, iterStat : ${theLoaiList}"> <span
							th:text="${t}"></span> <span th:if="${!iterStat.last}">, </span>
						</span>
					</p>
					<p>
						<strong th:text="#{tilte.runTime}">Thời lượng:</strong> <span
							th:text="${film.detailFilm.thoiLuong}"></span> phút
					</p>
					<p>
						<strong th:text="#{umenu.lang}">Ngôn ngữ:</strong> <span
							th:text="${film.detailFilm.ngonNgu}"></span>
					</p>
				 <p>
      <strong>Đánh giá :</strong>
      <span th:text="${#numbers.formatDecimal(averageStar,1,1)}">0.0</span> ★ /5 ★
      từ <span th:text="${ratingCount}">0</span> lượt
    </p>


					<!-- Nút Xem Trailer & Đặt vé -->
					<a href="#" id="showTrailerBtn" class="btn btn-danger me-2"> <i
						class="bi bi-play-circle"></i> <span th:text="#{btn.trailer}">Xem
							Trailer</span>
					</a> <a th:href="@{'/booking/choose-show/' + ${film.id}}"
						class="btn btn-success"> <i
						class="bi bi-ticket-perforated-fill"></i> <span
						th:text="#{btn.getTicket}">Đặt vé</span>
					</a>

				</div>
			</div>
		</div>

		<!-- Trailer -->
		<div class="container mt-5 d-none" id="trailerSection">
			<h2 class="mb-4">Trailer chính thức</h2>
			<div class="ratio ratio-16x9">
				<iframe width="560" height="315" th:src="${trailerUrl}"
					title="YouTube video player" frameborder="0"
					allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
					referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>
				</iframe>
			</div>
		</div>
		
		<!-- Form đánh giá sao -->
  <div class="container mt-5">
    <form th:action="@{'/film/' + ${film.id} + '/rating'}" method="post">
      <h2>Đánh giá của bạn</h2>
      <div class="star-rating mb-3">
        <input type="radio" id="star5" name="star" value="5" required><label for="star5">★</label>
        <input type="radio" id="star4" name="star" value="4"><label for="star4">★</label>
        <input type="radio" id="star3" name="star" value="3"><label for="star3">★</label>
        <input type="radio" id="star2" name="star" value="2"><label for="star2">★</label>
        <input type="radio" id="star1" name="star" value="1"><label for="star1">★</label>
      </div>
      <button type="submit" class="btn btn-warning">Gửi đánh giá</button>
    </form>
  </div>

  <!-- Form bình luận -->
  <div class="container mt-5">
    <form th:action="@{'/film/' + ${film.id} + '/comment'}" method="post">
      <h2>Bình luận của bạn</h2>
      <div class="mb-3">
        <textarea class="form-control" name="content" rows="3"
                  placeholder="Viết cảm nghĩ về phim..." required></textarea>
      </div>
      <button type="submit" class="btn btn-primary">Gửi bình luận</button>
    </form>
  </div>

  <div class="container mt-5">
  <h2 class="mb-4">Danh sách bình luận (<span th:text="${commentCount}">0</span>)</h2>
  <div th:each="c, stat : ${comments}" class="mb-3 border-bottom pb-3">
    <div class="d-flex align-items-center mb-2">
     <img th:src="@{${c.account.avatar}}" 
           class="rounded-circle me-2 border" 
           width="40" height="40" alt="avatar"> -->
      <div>
        <strong th:text="${c.account.fullname}">Tên người dùng</strong>
        <div class="text-muted small" th:text="${#temporals.format(c.createdAt, 'dd/MM/yyyy HH:mm')}">Thời gian</div>
      </div>
    </div>
    <div class="mb-1" th:text="${c.content}">Nội dung bình luận</div>   
  </div>
</div>

		
			<script
				src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

			<!-- Script đa ngôn ngữ cho nút Trailer -->
			<script th:inline="javascript">
				/*<![CDATA[*/
				document
						.addEventListener(
								"DOMContentLoaded",
								function() {
									const showTrailerBtn = document
											.getElementById("showTrailerBtn");
									const trailerSection = document
											.getElementById("trailerSection");

									// Text theo ngôn ngữ
									var showTrailerText = /*[[#{btn.trailer}]]*/'Xem trailer';
									var hideTrailerText = /*[[#{btn.utrailer}]]*/'Ẩn trailer';

									showTrailerBtn
											.addEventListener(
													"click",
													function(e) {
														e.preventDefault();
														if (trailerSection.classList
																.contains("d-none")) {
															trailerSection.classList
																	.remove("d-none");
															showTrailerBtn.innerHTML = '<i class="bi bi-x-circle"></i> <span>'
																	+ hideTrailerText
																	+ '</span>';
														} else {
															trailerSection.classList
																	.add("d-none");
															showTrailerBtn.innerHTML = '<i class="bi bi-play-circle"></i> <span>'
																	+ showTrailerText
																	+ '</span>';
														}
													});
								});
				/*]]>*/
			</script>

			<!-- Navbar hiệu ứng khi cuộn -->
			<script>
				document.addEventListener('DOMContentLoaded', function() {
					const navbar = document.querySelector('.navbar-black');
					if (!navbar)
						return;
					window.addEventListener('scroll', function() {
						if (window.scrollY > 50) {
							navbar.classList.add('scrolled');
						} else {
							navbar.classList.remove('scrolled');
						}
					});
				});
			</script>

			<script src="js/common.js"></script>
	</article>
</body>
</html>
